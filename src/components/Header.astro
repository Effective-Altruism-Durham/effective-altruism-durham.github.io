---
/**
 * Header component - Site navigation header
 * 
 * Features:
 * - Desktop dropdown navigation
 * - Mobile hamburger menu (Saarland-style)
 * - Dark mode toggle
 * - Responsive logo/title display
 * 
 * Dependencies:
 * - ../data/config.ts for site config (social links)
 * - ../assets/DAISI-logo.svg for logo
 * - CSS classes from public/css/styles.css (.header, .nav-*, .burger, .mobile-nav, etc.)
 */
import { siteConfig } from '../data/config';
import Logo from '../assets/DAISI-logo.svg';

const { pathname } = Astro.url;
const isHome = pathname === '/';
---

<header class:list={["header", "no-print", { "header--transparent": isHome }]} id="siteHeader">
    <div class="site-container">
        <nav class="nav">
            <a href="/" class="nav-brand">
                <img src={Logo.src} alt="Durham AISI Logo" class="h-8 w-auto md:h-10" loading="lazy" decoding="async" />
                <div>
                    <h1 class="nav-title">
                        <span class="gradient-text">Effective</span>
                        <span class="gradient-text">Altruism</span>
                        <span>Durham</span>
                    </h1>
                </div>
            </a>
            
            <!-- Mobile hamburger button (Saarland-style) -->
            <button 
                type="button" 
                class="burger" 
                id="burgerBtn" 
                aria-label="Toggle mobile menu"
                aria-expanded="false"
            >
                <div class="burger-box">
                    <div class="burger-inner"></div>
                </div>
            </button>
            
            <!-- Desktop navigation - center -->
            <div class="nav-center nav-menu-desktop">
                <a href="/" class="nav-link">Home</a>
                <a href="/#events" class="nav-link">Events</a>
                <a href="/about/" class="nav-link">About</a>
                
                <div class="dropdown">
                    <button type="button" class="nav-link dropdown-toggle" aria-expanded="false" aria-haspopup="true">
                        More <i class="fas fa-chevron-down text-sm" aria-hidden="true"></i>
                    </button>
                    <div class="dropdown-content">
                        <a href="/programs/">Programs</a>
                        <a href="/research/">Research</a>
                        <a href="/what-is-ai-safety/">What is AI Safety?</a>
                    </div>
                </div>
            </div>
            
            <!-- Desktop right section: social, dark mode, CTA -->
            <div class="nav-right nav-menu-desktop">
                <a href={siteConfig.social.instagram} class="nav-social" aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-instagram" aria-hidden="true"></i>
                </a>
                <a href={siteConfig.social.discord} class="nav-social" aria-label="Discord" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-discord" aria-hidden="true"></i>
                </a>
                <a href="https://www.linkedin.com/company/durhamaisafety/" class="nav-social" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-linkedin" aria-hidden="true"></i>
                </a>
                <a href={siteConfig.social.linktree} class="nav-social" aria-label="Linktree" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-link" aria-hidden="true"></i>
                </a>
                
                <button type="button" class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
                
                <a href="/get-involved/" class="nav-cta">
                    Get Involved
                </a>
            </div>
        </nav>
    </div>
</header>

<!-- Full-screen mobile menu overlay - MUST be outside header to avoid backdrop-filter containment -->
<div class="mobile-nav" id="mobileNav" aria-hidden="true">
    <button 
        type="button" 
        class="mobile-nav-close burger burger--active" 
        id="mobileNavClose" 
        aria-label="Close mobile menu"
    >
        <div class="burger-box">
            <div class="burger-inner"></div>
        </div>
    </button>
    
    <div class="mobile-nav-content">
        <a href="/" class="flex items-center gap-3 mb-6 pb-4 border-b border-white/20">
            <img src={Logo.src} alt="Durham AISI Logo" class="h-10 w-auto" />
            <div>
                <span class="text-lg font-bold">Durham</span>
                <span class="text-lg font-bold gradient-text"> AI Safety</span>
                <span class="text-lg font-bold"> Initiative</span>
            </div>
        </a>
        <a href="/" class="mobile-nav-link">Home</a>
        <a href="/#events" class="mobile-nav-link">Events</a>
        <a href="/about/" class="mobile-nav-link">About Us</a>
        <a href="/programs/" class="mobile-nav-link">Programs</a>
        <a href="/research/" class="mobile-nav-link">Research</a>
        <a href="/what-is-ai-safety/" class="mobile-nav-link">What is AI Safety?</a>
        <a href="/get-involved/" class="mobile-nav-link bg-durham-purple text-white rounded-lg px-4 py-2 font-semibold hover:bg-[#7a2d80] transition-colors">Get Involved</a>
        
        <div class="mobile-nav-footer">
            <div class="mobile-social-links">
                <a href={siteConfig.social.instagram} aria-label="Instagram" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href={siteConfig.social.discord} aria-label="Discord" target="_blank" rel="noopener noreferrer">
                    <i class="fa-brands fa-discord"></i>
                </a>
                <a href={siteConfig.social.linktree} aria-label="Linktree" target="_blank" rel="noopener noreferrer">
                    <i class="fa-solid fa-link"></i>
                </a>
            </div>
            
            <button type="button" class="dark-mode-toggle" id="darkModeToggleMobile" aria-label="Toggle dark mode">
                <i class="fas fa-moon" aria-hidden="true"></i>
            </button>
        </div>
    </div>
</div>

<script>
    // Mobile menu toggle
    const burgerBtn = document.getElementById('burgerBtn');
    const mobileNav = document.getElementById('mobileNav');
    const mobileNavClose = document.getElementById('mobileNavClose');
    
    function openMobileMenu() {
        if (burgerBtn && mobileNav) {
            burgerBtn.classList.add('burger--active');
            mobileNav.classList.add('mobile-nav--active');
            burgerBtn.setAttribute('aria-expanded', 'true');
            mobileNav.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
        }
    }
    
    function closeMobileMenu() {
        if (burgerBtn && mobileNav) {
            burgerBtn.classList.remove('burger--active');
            mobileNav.classList.remove('mobile-nav--active');
            burgerBtn.setAttribute('aria-expanded', 'false');
            mobileNav.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
        }
    }
    
    if (burgerBtn) {
        burgerBtn.addEventListener('click', () => {
            const isOpen = mobileNav?.classList.contains('mobile-nav--active');
            if (isOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        });
    }
    
    if (mobileNavClose) {
        mobileNavClose.addEventListener('click', closeMobileMenu);
    }
    
    // Close menu when clicking a link
    if (mobileNav) {
        mobileNav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', closeMobileMenu);
        });
    }
    
    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mobileNav?.classList.contains('mobile-nav--active')) {
            closeMobileMenu();
        }
    });
    
    // Sync dark mode toggle for mobile
    const darkModeToggleMobile = document.getElementById('darkModeToggleMobile');
    if (darkModeToggleMobile) {
        darkModeToggleMobile.addEventListener('click', () => {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
            
            // Update all dark mode icons
            document.querySelectorAll('.dark-mode-toggle i').forEach(icon => {
                icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            });
        });
        
        // Sync initial state
        const isDark = document.documentElement.classList.contains('dark');
        darkModeToggleMobile.querySelector('i').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
    }
    
    // Transparent header scroll effect
    const siteHeader = document.getElementById('siteHeader');
    if (siteHeader?.classList.contains('header--transparent')) {
        let ticking = false;
        
        const updateHeaderOnScroll = () => {
            if (window.scrollY > 50) {
                siteHeader.classList.add('header--scrolled');
            } else {
                siteHeader.classList.remove('header--scrolled');
            }
            ticking = false;
        };
        
        window.addEventListener('scroll', () => {
            if (!ticking) {
                requestAnimationFrame(updateHeaderOnScroll);
                ticking = true;
            }
        }, { passive: true });
        
        // Check initial scroll position
        updateHeaderOnScroll();
    }
</script>
